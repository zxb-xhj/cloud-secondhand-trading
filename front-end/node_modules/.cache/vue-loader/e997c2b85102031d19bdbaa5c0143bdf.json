{"remainingRequest":"E:\\SoftwareDevelopment\\software\\开源二手商城\\cloud-secondhand-trading\\front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\SoftwareDevelopment\\software\\开源二手商城\\cloud-secondhand-trading\\front-end\\src\\views\\component\\singleUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\SoftwareDevelopment\\software\\开源二手商城\\cloud-secondhand-trading\\front-end\\src\\views\\component\\singleUpload.vue","mtime":1694356754356},{"path":"E:\\SoftwareDevelopment\\software\\开源二手商城\\cloud-secondhand-trading\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\SoftwareDevelopment\\software\\开源二手商城\\cloud-secondhand-trading\\front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\SoftwareDevelopment\\software\\开源二手商城\\cloud-secondhand-trading\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\SoftwareDevelopment\\software\\开源二手商城\\cloud-secondhand-trading\\front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBwb2xpY3kgfSBmcm9tICdAL2FwaS9vc3MvcG9saWN5Jw0KaW1wb3J0IHsgZ2V0VVVJRCB9IGZyb20gJ0AvdXRpbHMnDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ1NpbmdsZVVwbG9hZCcsDQogIHByb3BzOiB7DQogICAgdmFsdWU6IFN0cmluZw0KICB9LA0KICBjb21wdXRlZDogew0KICAgIGltYWdlVXJsKCkgew0KICAgICAgcmV0dXJuIHRoaXMudmFsdWU7DQogICAgfSwNCiAgICBpbWFnZU5hbWUoKSB7DQogICAgICBpZiAodGhpcy52YWx1ZSAhPSBudWxsICYmIHRoaXMudmFsdWUgIT09ICcnKSB7DQogICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnN1YnN0cih0aGlzLnZhbHVlLmxhc3RJbmRleE9mKCcvJykgKyAxKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICB9DQogICAgfSwNCiAgICBmaWxlTGlzdCgpIHsNCiAgICAgIHJldHVybiBbew0KICAgICAgICBuYW1lOiB0aGlzLmltYWdlTmFtZSwNCiAgICAgICAgdXJsOiB0aGlzLmltYWdlVXJsDQogICAgICB9XQ0KICAgIH0sDQogICAgc2hvd0ZpbGVMaXN0OiB7DQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy52YWx1ZSAhPT0gbnVsbCAmJiB0aGlzLnZhbHVlICE9PSAnJyAmJiB0aGlzLnZhbHVlICE9PSB1bmRlZmluZWQNCiAgICAgIH0sDQogICAgICBzZXQ6IGZ1bmN0aW9uKG5ld1ZhbHVlKSB7DQogICAgICB9DQogICAgfQ0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBkYXRhT2JqOiB7DQogICAgICAgIHBvbGljeTogJycsDQogICAgICAgIHNpZ25hdHVyZTogJycsDQogICAgICAgIGtleTogJycsDQogICAgICAgIG9zc2FjY2Vzc0tleUlkOiAnJywNCiAgICAgICAgZGlyOiAnJywNCiAgICAgICAgaG9zdDogJycsDQogICAgICAgIC8vIGNhbGxiYWNrOicnLA0KICAgICAgfSwNCiAgICAgIGRpYWxvZ1Zpc2libGU6IGZhbHNlDQogICAgfQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgZW1pdElucHV0KHZhbCkgew0KICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB2YWwpDQogICAgfSwNCiAgICBoYW5kbGVSZW1vdmUoZmlsZSwgZmlsZUxpc3QpIHsNCiAgICAgIHRoaXMuZW1pdElucHV0KCcnKQ0KICAgIH0sDQogICAgaGFuZGxlUHJldmlldyhmaWxlKSB7DQogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSB0cnVlDQogICAgfSwNCiAgICBiZWZvcmVVcGxvYWQoZmlsZSkgew0KICAgICAgY29uc3QgX3NlbGYgPSB0aGlzDQogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICBwb2xpY3koKS50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICBjb25zb2xlLmxvZygn5ZON5bqU55qE5pWw5o2uJywgcmVzcG9uc2UpDQogICAgICAgICAgX3NlbGYuZGF0YU9iai5wb2xpY3kgPSByZXNwb25zZS5kYXRhLnBvbGljeQ0KICAgICAgICAgIF9zZWxmLmRhdGFPYmouc2lnbmF0dXJlID0gcmVzcG9uc2UuZGF0YS5zaWduYXR1cmUNCiAgICAgICAgICBfc2VsZi5kYXRhT2JqLm9zc2FjY2Vzc0tleUlkID0gcmVzcG9uc2UuZGF0YS5hY2Nlc3NpZA0KICAgICAgICAgIF9zZWxmLmRhdGFPYmoua2V5ID0gcmVzcG9uc2UuZGF0YS5kaXIgKyBnZXRVVUlEKCkgKyAnXyR7ZmlsZW5hbWV9Jw0KICAgICAgICAgIF9zZWxmLmRhdGFPYmouZGlyID0gcmVzcG9uc2UuZGF0YS5kaXINCiAgICAgICAgICBfc2VsZi5kYXRhT2JqLmhvc3QgPSByZXNwb25zZS5kYXRhLmhvc3QNCiAgICAgICAgICBjb25zb2xlLmxvZygn5ZON5bqU55qE5pWw5o2uMjIy44CC44CC44CCJywgX3NlbGYuZGF0YU9iaikNCiAgICAgICAgICByZXNvbHZlKHRydWUpDQogICAgICAgIH0pLmNhdGNoKGVyciA9PiB7DQogICAgICAgICAgcmVqZWN0KGZhbHNlKQ0KICAgICAgICB9KQ0KICAgICAgfSkNCiAgICB9LA0KICAgIGhhbmRsZVVwbG9hZFN1Y2Nlc3MocmVzLCBmaWxlKSB7DQogICAgICBjb25zb2xlLmxvZygn5LiK5Lyg5oiQ5YqfLi4uJykNCiAgICAgIHRoaXMuc2hvd0ZpbGVMaXN0ID0gdHJ1ZTsNCiAgICAgIHRoaXMuZmlsZUxpc3QucG9wKCk7DQogICAgICB0aGlzLmZpbGVMaXN0LnB1c2goe25hbWU6IGZpbGUubmFtZSwgdXJsOiB0aGlzLmRhdGFPYmouaG9zdCArICcvJyArIHRoaXMuZGF0YU9iai5rZXkucmVwbGFjZSgiJHtmaWxlbmFtZX0iLGZpbGUubmFtZSkgfSk7DQogICAgICB0aGlzLmVtaXRJbnB1dCh0aGlzLmZpbGVMaXN0WzBdLnVybCk7DQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["singleUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"singleUpload.vue","sourceRoot":"src/views/component","sourcesContent":["<template>\r\n  <div>\r\n    <el-upload\r\n      action=\"http://gulimall-xfwang.oss-cn-shanghai.aliyuncs.com\"\r\n      :data=\"dataObj\"\r\n      list-type=\"picture\"\r\n      :multiple=\"false\" :show-file-list=\"showFileList\"\r\n      :file-list=\"fileList\"\r\n      :before-upload=\"beforeUpload\"\r\n      :on-remove=\"handleRemove\"\r\n      :on-success=\"handleUploadSuccess\"\r\n      :on-preview=\"handlePreview\">\r\n      <el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n      <div slot=\"tip\" class=\"el-upload__tip\">只能上传jpg/png文件，且不超过10MB</div>\r\n    </el-upload>\r\n    <el-dialog :visible.sync=\"dialogVisible\">\r\n      <img width=\"100%\" :src=\"fileList[0].url\" alt=\"\">\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { policy } from '@/api/oss/policy'\r\nimport { getUUID } from '@/utils'\r\n\r\nexport default {\r\n  name: 'SingleUpload',\r\n  props: {\r\n    value: String\r\n  },\r\n  computed: {\r\n    imageUrl() {\r\n      return this.value;\r\n    },\r\n    imageName() {\r\n      if (this.value != null && this.value !== '') {\r\n        return this.value.substr(this.value.lastIndexOf('/') + 1)\r\n      } else {\r\n        return null;\r\n      }\r\n    },\r\n    fileList() {\r\n      return [{\r\n        name: this.imageName,\r\n        url: this.imageUrl\r\n      }]\r\n    },\r\n    showFileList: {\r\n      get: function() {\r\n        return this.value !== null && this.value !== '' && this.value !== undefined\r\n      },\r\n      set: function(newValue) {\r\n      }\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      dataObj: {\r\n        policy: '',\r\n        signature: '',\r\n        key: '',\r\n        ossaccessKeyId: '',\r\n        dir: '',\r\n        host: '',\r\n        // callback:'',\r\n      },\r\n      dialogVisible: false\r\n    }\r\n  },\r\n  methods: {\r\n    emitInput(val) {\r\n      this.$emit('input', val)\r\n    },\r\n    handleRemove(file, fileList) {\r\n      this.emitInput('')\r\n    },\r\n    handlePreview(file) {\r\n      this.dialogVisible = true\r\n    },\r\n    beforeUpload(file) {\r\n      const _self = this\r\n      return new Promise((resolve, reject) => {\r\n        policy().then(response => {\r\n          console.log('响应的数据', response)\r\n          _self.dataObj.policy = response.data.policy\r\n          _self.dataObj.signature = response.data.signature\r\n          _self.dataObj.ossaccessKeyId = response.data.accessid\r\n          _self.dataObj.key = response.data.dir + getUUID() + '_${filename}'\r\n          _self.dataObj.dir = response.data.dir\r\n          _self.dataObj.host = response.data.host\r\n          console.log('响应的数据222。。。', _self.dataObj)\r\n          resolve(true)\r\n        }).catch(err => {\r\n          reject(false)\r\n        })\r\n      })\r\n    },\r\n    handleUploadSuccess(res, file) {\r\n      console.log('上传成功...')\r\n      this.showFileList = true;\r\n      this.fileList.pop();\r\n      this.fileList.push({name: file.name, url: this.dataObj.host + '/' + this.dataObj.key.replace(\"${filename}\",file.name) });\r\n      this.emitInput(this.fileList[0].url);\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style>\r\n</style>\r\n"]}]}